<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="theme-color" content="#166534" />
  <link rel="icon" type="image/png" href="/favicon.png" />
  <link rel="manifest" href="/manifest.json" />
  <script type="module" src="js/app.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <link rel="stylesheet" href="style.css" />
  <title>Orgânia - Painel do Agrônomo</title>
</head>
<body class="bg-gray-100 text-gray-800">
  <div id="dashboard-agronomo-marker" hidden></div>

  <main id="agroMain" class="pb-16">
    <section id="view-home" data-view>
      <h2 class="p-4 font-semibold">Home</h2>
      <div id="homeMetrics" class="p-4 grid gap-4 sm:grid-cols-3">
        <div class="bg-white p-4 rounded shadow text-center">
          <div class="text-sm text-gray-500">Clientes ativos</div>
          <div id="metricClients" class="text-2xl font-bold">0</div>
          <div class="text-xs text-gray-600">total</div>
        </div>
        <div class="bg-white p-4 rounded shadow text-center">
          <div class="text-sm text-gray-500">Visitas</div>
          <div id="metricVisits" class="text-2xl font-bold">0</div>
          <div class="text-xs text-gray-600">últimos 30 dias</div>
        </div>
        <div class="bg-white p-4 rounded shadow text-center">
          <div class="text-sm text-gray-500">Vendas (t)</div>
          <div id="metricSales" class="text-2xl font-bold">0</div>
          <div class="text-xs text-gray-600">últimos 30 dias</div>
        </div>
      </div>
      <div id="homeQuickActions" class="px-4 flex gap-2">
        <button id="chipAddCliente" class="chip">Adicionar cliente</button>
        <button id="chipAddLead" class="chip">Adicionar lead</button>
        <button id="chipRegVisit" class="chip">Registrar visita</button>
      </div>
      <div id="agendaHome" class="p-4">
        <div class="flex items-center justify-between mb-2">
          <h3 class="font-semibold">Próximos compromissos</h3>
          <select id="agendaPeriod" class="input w-32">
            <option value="7">7 dias</option>
            <option value="30">30 dias</option>
            <option value="90">90 dias</option>
          </select>
        </div>
        <ul id="agendaList" class="divide-y"></ul>
        <div id="agendaEmpty" class="empty-state hidden">
          <p>Nenhum compromisso futuro.</p>
          <button id="btnAgendaAddVisit" class="btn-primary">Registrar visita</button>
        </div>
      </div>
    </section>
    <section id="view-clientes" data-view class="hidden">
      <h2 class="p-4 font-semibold">Clientes</h2>
      <div class="p-4 flex gap-2">
        <input id="clientsSearch" type="text" class="input flex-1" placeholder="Buscar" />
        <select id="clientsFilter" class="input w-56">
          <option value="all">Todos</option>
          <option value="recent">Com visitas nos últimos 30 dias</option>
          <option value="stale">Sem contato há 30+ dias</option>
        </select>
      </div>
      <div id="clientsList" class="p-4 grid gap-4 sm:grid-cols-2 lg:grid-cols-3"></div>
      <div id="clientsEmpty" class="p-4 empty-state hidden text-center">
        <p class="mb-2">Nenhum cliente encontrado.</p>
        <button id="btnClientsQuickAdd" class="btn-primary">Cadastrar cliente</button>
      </div>
    </section>
    <section id="view-mapa" data-view class="hidden">
      <div id="mapFilters" class="p-4 flex gap-2">
        <button id="mapFilterAll" class="chip chip--filter filter-active">Todos</button>
        <button id="mapFilterClients" class="chip chip--filter">Clientes</button>
        <button id="mapFilterLeads" class="chip chip--filter">Leads</button>
      </div>
      <div id="agroMap" style="height: calc(100vh - 196px)"></div>
    </section>
    <section id="view-ajustes" data-view class="hidden">
      <h2 class="p-4 font-semibold">Ajustes</h2>
    </section>
  </main>

  <nav id="bottomBar" class="bottom-bar">
    <button data-nav="#home"><i class="fas fa-home"></i></button>
    <button data-nav="#clientes"><i class="fas fa-users"></i></button>
    <button id="navPlus" class="plus-btn"><i class="fas fa-plus"></i></button>
    <button data-nav="#mapa"><i class="fas fa-map"></i></button>
    <button data-nav="#ajustes"><i class="fas fa-cog"></i></button>
  </nav>

  <div id="quickActionsModal" class="modal hidden">
    <div class="modal-card">
      <h3 class="mb-4 font-semibold">Ações Rápidas</h3>
      <div class="flex flex-col gap-2 mb-4">
        <button id="btnQuickAddCliente" class="btn-primary">Adicionar Cliente</button>
        <button id="btnQuickAddLead" class="btn-primary">Adicionar Lead</button>
        <button id="btnQuickRegVisita" class="btn-primary">Registrar Visita</button>
      </div>
      <button id="btnQuickClose" class="btn-secondary w-full">Fechar</button>
    </div>
  </div>

  <div id="addLeadModal" class="modal hidden">
    <div class="modal-card max-w-2xl w-full">
      <h3 class="mb-4 font-semibold">Adicionar Lead</h3>
      <form id="leadForm" class="grid gap-4 md:grid-cols-2">
        <div class="flex flex-col gap-2">
          <div class="field">
            <label for="leadNome">Nome do lead*</label>
            <input id="leadNome" required class="input" />
          </div>
          <div class="field">
            <label for="leadPropriedade">Propriedade/Fazenda*</label>
            <input id="leadPropriedade" required class="input" />
          </div>
          <div class="field">
            <label for="leadNotas">Notas</label>
            <textarea id="leadNotas" class="input"></textarea>
          </div>
          <div class="field">
            <label>Localização</label>
            <button type="button" id="btnUseLocation" class="btn-secondary mb-2">Usar minha localização</button>
            <div class="flex gap-2">
              <input id="leadLat" class="input flex-1" placeholder="Lat" readonly />
              <input id="leadLng" class="input flex-1" placeholder="Lng" readonly />
            </div>
          </div>
        </div>
        <div id="leadMap" class="h-48 md:h-full"></div>
        <div class="flex gap-2 justify-end md:col-span-2">
          <button type="button" id="btnCancelLead" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="visitModal" class="modal hidden">
    <div class="modal-card max-w-xl w-full">
      <h3 class="mb-4 font-semibold">Registrar Visita</h3>
      <form id="visitForm" class="grid gap-4">
        <div>
          <label><input type="radio" name="visitTarget" value="cliente" checked /> Cliente</label>
          <label class="ml-4"><input type="radio" name="visitTarget" value="lead" /> Lead</label>
        </div>
        <div class="field">
          <label for="visitTargetSelect">Selecione</label>
          <select id="visitTargetSelect" class="input"></select>
        </div>
        <button type="button" id="btnVisitQuickCreate" class="btn-secondary">Cadastrar novo (rápido)</button>
        <div class="field">
          <label for="visitAt">Data/Hora</label>
          <input id="visitAt" type="datetime-local" class="input" required />
        </div>
        <div class="field">
          <label for="visitNotes">Descrição*</label>
          <textarea id="visitNotes" class="input" required></textarea>
        </div>
        <div id="leadExtras" class="hidden">
          <div class="field">
            <label for="visitInterest">Interesse*</label>
            <select id="visitInterest" class="input">
              <option value="">Selecione</option>
              <option value="Interessado">Interessado</option>
              <option value="Na dúvida">Na dúvida</option>
              <option value="Sem interesse">Sem interesse</option>
            </select>
          </div>
          <div class="field">
            <label for="visitSale">Venda?</label>
            <select id="visitSale" class="input">
              <option value="nao">Não</option>
              <option value="sim">Sim</option>
            </select>
          </div>
          <div id="leadFollowUp" class="hidden">
            <div class="field">
              <label for="visitReturnAt">Agendar retorno</label>
              <input id="visitReturnAt" type="datetime-local" class="input" />
            </div>
            <div class="field">
              <label for="visitReturnNote">Nota</label>
              <input id="visitReturnNote" class="input" />
            </div>
          </div>
          <div id="leadReason" class="hidden">
            <div class="field">
              <label for="visitReason">Motivo</label>
              <input id="visitReason" class="input" />
            </div>
          </div>
        </div>
        <div class="flex gap-2 justify-end">
          <button type="button" id="btnVisitCancel" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="saleModal" class="modal hidden">
    <div class="modal-card max-w-md w-full">
      <h3 class="mb-4 font-semibold">Registrar Venda</h3>
      <form id="saleForm" class="grid gap-4">
        <div class="field">
          <label for="saleFormula">Fórmula</label>
          <select id="saleFormula" class="input"></select>
        </div>
        <div class="field">
          <label for="saleTons">Toneladas</label>
          <input id="saleTons" type="number" min="0.1" step="0.1" class="input" required />
        </div>
        <div class="field">
          <label for="saleNote">Observação</label>
          <textarea id="saleNote" class="input"></textarea>
        </div>
        <div class="flex gap-2 justify-end">
          <button type="button" id="btnSaleCancel" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <div id="quickCreateModal" class="modal hidden">
    <div class="modal-card max-w-xl w-full">
      <h3 class="mb-4 font-semibold">Cadastro Rápido</h3>
      <form id="quickCreateForm" class="grid gap-4">
        <div>
          <label><input type="radio" name="quickType" value="cliente" checked /> Cliente</label>
          <label class="ml-4"><input type="radio" name="quickType" value="lead" /> Lead</label>
        </div>
        <div class="field">
          <label for="qcName">Nome*</label>
          <input id="qcName" class="input" required />
        </div>
        <div class="field">
          <label for="qcFarm">Fazenda*</label>
          <input id="qcFarm" class="input" required />
        </div>
        <div class="field">
          <label for="qcNotes">Notas</label>
          <textarea id="qcNotes" class="input"></textarea>
        </div>
        <div class="field">
          <label>Localização</label>
          <button type="button" id="qcUseLocation" class="btn-secondary mb-2">Usar minha localização</button>
          <div class="flex gap-2">
            <input id="qcLat" class="input flex-1" placeholder="Lat" readonly />
            <input id="qcLng" class="input flex-1" placeholder="Lng" readonly />
          </div>
        </div>
        <div class="flex gap-2 justify-end">
          <button type="button" id="btnQCCancel" class="btn-secondary">Cancelar</button>
          <button type="submit" class="btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>

  <script src="/__/firebase/9.6.1/firebase-app-compat.js"></script>
  <script src="/__/firebase/9.6.1/firebase-auth-compat.js"></script>
  <script src="/__/firebase/9.6.1/firebase-firestore-compat.js"></script>
  <script src="/__/firebase/init.js"></script>
  <script type="module" src="js/services/auth.js"></script>
  <script type="module" src="js/pages/dashboard-agronomo.js"></script>
</body>
</html>
